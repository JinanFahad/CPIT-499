<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 88vh; width: 100vw; }
    .bar { padding: 10px 12px; display:flex; gap:10px; align-items:center; }
    button { padding: 8px 12px; cursor:pointer; }
    button:disabled { opacity: .5; cursor:not-allowed; }
    pre { height: 12vh; margin:0; overflow:auto; padding:10px; background:#f5f5f5; direction:ltr; }
  </style>
</head>
<body>

  <div class="bar">
    <span>ğŸ“ Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯</span>

    <button id="saveBtn" disabled type="button">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
    <button id="analyzeBtn" disabled type="button" onclick="analyzeLocation()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>

    <input type="hidden" id="lat">
    <input type="hidden" id="lng">
  </div>

  <div id="map"></div>
  <pre id="out">{}</pre>

  <script>
    let map;
    let marker;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 21.5433, lng: 39.1728 }, // Ø¬Ø¯Ø©
        zoom: 12,
      });

      map.addListener("click", function (event) {
        const lat = event.latLng.lat();
        const lng = event.latLng.lng();

        if (marker) marker.setMap(null);

        marker = new google.maps.Marker({
          position: { lat, lng },
          map,
        });

        document.getElementById("lat").value = lat;
        document.getElementById("lng").value = lng;

        // ÙØ¹Ù‘Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById("saveBtn").disabled = false;
        document.getElementById("analyzeBtn").disabled = false;

        document.getElementById("out").textContent = JSON.stringify({ selected: { lat, lng } }, null, 2);
      });

      // Ù…Ø«Ø§Ù„ Ù„Ù„Ø­ÙØ¸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ): ÙÙ‚Ø· ÙŠØ«Ø¨Øª Ø¥Ù†Ù‡ Ù…Ø­ÙÙˆØ¸
      document.getElementById("saveBtn").addEventListener("click", () => {
        const lat = document.getElementById("lat").value;
        const lng = document.getElementById("lng").value;
        alert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${lat}, ${lng}`);
      });
    }

    function analyzeLocation() {
      const lat = document.getElementById("lat").value;
      const lng = document.getElementById("lng").value;

      if (!lat || !lng) {
        alert("Ø§Ø®ØªØ§Ø±ÙŠ Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }

      // ØºÙŠÙ‘Ø±ÙŠ type Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙŠÙˆØ²Ø±
      fetch(`/analyze?lat=${encodeURIComponent(lat)}&lng=${encodeURIComponent(lng)}&type=restaurant`)
        .then(res => res.json())
        .then(data => {
          document.getElementById("out").textContent = JSON.stringify(data, null, 2);
        })
        .catch(err => {
          document.getElementById("out").textContent = JSON.stringify({ error: String(err) }, null, 2);
        });
    }
  </script>

  <!-- Ù„Ø§Ø²Ù… ØªØ¶ÙŠÙÙŠ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø®Ø±Ø§Ø¦Ø· (Ø­Ø·ÙŠ API KEY Ø­Ù‚Ùƒ) -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMVLHJiz-3hOnp-oOPPE2r72fjKwf6xcQ&callback=initMap&language=ar">
  </script>

</body>
</html>